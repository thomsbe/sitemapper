[Unit]
Description=Solr Sitemap Generator Service
Documentation=https://github.com/example/sitemapper
After=network.target network-online.target
Wants=network-online.target

[Service]
Type=oneshot
User=sitemapper
Group=sitemapper
WorkingDirectory=/opt/sitemapper
Environment=PATH=/usr/local/bin:/usr/bin:/bin
Environment=PYTHONPATH=/opt/sitemapper/src

# Main command
ExecStart=/usr/local/bin/uvx sitemapper --config /etc/sitemapper/config.toml --service-mode --pid-file /var/run/sitemapper.pid

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=sitemapper

# Security settings
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/var/log/sitemapper /var/run /opt/sitemapper/output

# Resource limits
MemoryMax=2G
CPUQuota=200%
TimeoutStartSec=300
TimeoutStopSec=30

# Restart policy
Restart=on-failure
RestartSec=30
StartLimitInterval=300
StartLimitBurst=3

[Install]
WantedBy=multi-user.target